// Auto-generated fire animation for LED tree
// Generated from: simulator/led_positions.csv
// Number of LEDs: 830
// Tree height: 3681.8mm

#pragma once

#include "RaftCore.h"
#include <cmath>

class LEDPatternFire : public LEDPatternBase
{
public:
    LEDPatternFire(NamedValueProvider* pNamedValueProvider, LEDPixelIF& pixels) :
        LEDPatternBase(pNamedValueProvider, pixels)
    {
    }
    
    virtual ~LEDPatternFire() {}
    
    static LEDPatternBase* create(NamedValueProvider* pNamedValueProvider, LEDPixelIF& pixels)
    {
        return new LEDPatternFire(pNamedValueProvider, pixels);
    }
    
    virtual void setup(const char* pParamsJson = nullptr) override final
    {
        if (pParamsJson)
        {
            RaftJson paramsJson(pParamsJson, false);
            _refreshRateMs = paramsJson.getLong("rateMs", _refreshRateMs);
            _maxBrightnessPC = paramsJson.getDouble("brightnessPC", 100);
            _baseHeightMm = paramsJson.getDouble("baseHeightMm", 800.0);
            _flameSpeed = paramsJson.getDouble("flameSpeed", 600.0);
            _jetSpeed = paramsJson.getDouble("jetSpeed", 1500.0);
            _jetSpawnRate = paramsJson.getDouble("jetSpawnRate", 3.0);
        }
        
        // Initialize flame tongues
        for (uint32_t i = 0; i < NUM_FLAMES; i++)
        {
            _flamePos[i] = Z_MIN + random(_baseHeightMm);
            _flameActive[i] = true;
            _flameIntensity[i] = 0.85f + random(0.15f);
            _flameHeight[i] = 500.0f + random(700.0f);
            _flameWidth[i] = 200.0f + random(200.0f);
            _flameXOffset[i] = -600.0f + random(1200.0f);
            _flameYOffset[i] = -600.0f + random(1200.0f);
        }
        
        // Initialize jets
        for (uint32_t i = 0; i < NUM_JETS; i++)
        {
            _jetActive[i] = false;
            _jetPos[i] = Z_MIN;
        }
    }
    
    virtual void loop() override final
    {
        if (!Raft::isTimeout(millis(), _lastLoopMs, _refreshRateMs))
            return;
        
        uint32_t currentMs = millis();
        float dt = (currentMs - _lastLoopMs) / 1000.0f;
        float elapsed = currentMs / 1000.0f;
        _lastLoopMs = currentMs;
        
        // Update animation
        updateBaseFireEdge(elapsed, dt);
        updateFlames(elapsed, dt);
        updateJets(elapsed, dt);
        
        // Render to pixels
        renderToPixels(elapsed);
        _pixels.show();
    }

private:
    // Pre-computed LED data
    static constexpr uint32_t NUM_LEDS = 830;
    static constexpr float Z_MIN = 13.7f;
    static constexpr float Z_MAX = 3695.494285714286f;
    static constexpr float TREE_HEIGHT = 3681.794285714286f;
    static constexpr uint32_t NUM_FLAMES = 100;
    static constexpr uint32_t NUM_JETS = 30;
    
    // LED positions (x, y, z in mm)
    static constexpr float LED_X[NUM_LEDS] = {
        301.10f, 182.70f, 141.90f, 37.70f, -100.55f, -98.20f, -61.60f, 28.30f, 148.20f, 178.10f, 248.10f, 307.30f, 271.40f, 320.20f, 336.55f, 283.30f, 206.40f, 93.90f, 93.90f, -36.70f, -106.60f, -25.00f, 89.90f, 228.10f, 294.00f, 261.40f, 265.60f, 159.00f, 110.20f, -3.70f, -88.15f, -78.30f, -48.30f, 48.30f, 171.50f, 231.40f, 302.70f, 312.30f, 228.10f, 161.00f, 61.40f, -78.25f, -117.00f, -181.50f, -202.40f, -143.45f, -158.85f, -216.30f, -219.35f, -194.80f, -244.40f, -234.65f, -202.25f, -154.75f, -213.55f, -172.60f, 31.80f, 114.70f, 156.50f, 251.85f, 175.30f, 131.50f, 114.90f, 88.20f, -38.30f, -36.60f, -27.10f, 0.00f, -167.50f, -88.20f, 41.50f, 94.90f, -171.50f, -248.90f, -231.30f, 0.00f, 0.00f, 0.00f, 0.00f, -514.50f, 0.00f, -672.00f, -740.50f, -857.80f, -1207.10f, -1190.40f, -1060.60f, -1158.80f, -644.30f, -735.90f, -914.00f, -1090.50f, -625.10f, -813.90f, -1080.50f, -773.00f, -1073.90f, -1004.00f, -930.70f, -489.70f, -716.80f, -1013.30f, -1017.80f, -930.70f, -950.70f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, -276.90f, -281.80f, 0.00f, 0.00f, -251.30f, -299.60f, -141.50f, -18.30f, 101.60f, -54.90f, 0.00f, 0.00f, -151.50f, -84.40f, -25.00f, 118.20f, 51.60f, -118.60f, -11.70f, -91.60f, -144.80f, -261.10f, -296.00f, -201.50f, -109.90f, -199.65f, -241.40f, -431.20f, 0.00f, -316.40f, -191.00f, -191.50f, 0.00f, 0.00f, 0.00f, -568.80f, 0.00f, -797.50f, -999.00f, -927.40f, -904.10f, -784.20f, -586.10f, -467.80f, -484.50f, -772.50f, -591.10f, 0.00f, -825.30f, 0.00f, -474.50f, -521.10f, -804.20f, -213.80f, -292.50f, -311.30f, -258.20f, -623.20f, -511.10f, 0.00f, -371.00f, 0.00f, 0.00f, -274.20f, -328.00f, 0.00f, 0.00f, -296.60f, -287.70f, -201.50f, -188.10f, -164.35f, 17.00f, -83.60f, -213.80f, -94.90f, -61.60f, -258.20f, -270.00f, -117.70f, 21.60f, -101.60f, -258.20f, -108.20f, 0.00f, -21.60f, 0.00f, 0.00f, 0.00f, 0.00f, 0.00f, -83.60f, -201.50f, -129.35f, 0.00f, 216.75f, 17.00f, 150.70f, 230.10f, 437.90f, 416.50f, 487.00f, 726.10f, 778.30f, 792.90f, 665.00f, 611.70f, 874.25f, 990.60f, 972.95f, 884.00f, 970.40f, 1042.35f, 1100.00f, 1043.70f, 1419.70f, 1503.40f, 1499.60f, 1450.20f, 1432.30f, 1134.30f, 996.00f, 780.40f, 1117.20f, 906.85f, 685.70f, 1600.00f, 1102.90f, 1095.00f, 1422.50f, 1401.80f, 1100.00f, 1043.70f, 1077.85f, 1019.00f, 1147.30f, 1055.60f, 1132.50f, 1008.20f, 1083.70f, 1194.60f, 1247.90f, 1283.00f, 1409.15f, 1381.00f, 1585.20f, 1446.10f, 1600.00f, 1575.10f, 1508.30f, 1398.80f, 1509.30f, 1521.40f, 1398.80f, 1381.00f, 1422.50f, 1342.60f, 1392.30f, 1233.10f, 1147.70f, 1073.30f, 1070.35f, 572.15f, 856.85f, 777.15f, 707.20f, 586.45f, 215.30f, 218.35f, 163.40f, 215.05f, 336.75f, 333.40f, 351.50f, 298.45f, 364.35f, 423.65f, 230.10f, 179.80f, 220.60f, 417.40f, 348.00f, 382.40f, 263.15f, 246.30f, 202.45f, 228.50f, 399.60f, 354.60f, 0.00f, 165.00f, 420.20f, 464.25f, 434.20f, 175.45f, 161.50f, 419.40f, -315.90f, -311.40f, 0.00f, 514.50f, 468.30f, 387.40f, 384.60f, 391.30f, 0.00f, 58.40f, 223.70f, 176.80f, 304.70f, 154.80f, 102.25f, 0.00f, 0.00f, 2.20f, 0.00f, 114.90f, -142.85f, -349.90f, -349.90f, -355.80f, -218.10f, -346.90f, 0.00f, 0.00f, 0.00f, -432.70f, -311.55f, -171.50f, -305.50f, 0.00f, -174.30f, -319.15f, -713.30f, -358.70f, -313.25f, -358.00f, -361.30f, -330.65f, -316.30f, -326.20f, 0.00f, 0.00f, 0.00f, -770.00f, -551.50f, -742.75f, -835.60f, -1054.10f, -1021.50f, -1021.50f, -900.25f, -846.85f, -936.50f, -1166.50f, -1157.70f, -1122.60f, -1219.80f, -1164.50f, -1077.80f, 0.00f, 0.00f, -1326.30f, -1444.70f, -1341.10f, -1116.20f, -1096.60f, -1051.10f, -847.50f, -1014.30f, -1043.15f, -1110.30f, -885.10f, -1056.00f, -1021.50f, -835.10f, -1054.10f, -798.55f, -835.10f, -704.30f, -108.40f, -873.60f, -767.50f, -599.50f, -696.50f, 0.00f, 0.00f, -633.90f, -565.90f, -489.00f, -490.40f, 0.00f, 0.00f, 93.90f, -221.40f, 336.60f, 94.40f, 197.50f, 336.60f, 419.90f, -130.90f, -0.70f, 659.10f, 472.70f, 514.10f, 277.50f, 484.50f, 375.00f, 420.90f, 468.70f, 375.00f, 286.30f, 0.00f, 236.40f, 0.00f, 126.50f, 221.20f, 200.90f, -2.70f, -308.50f, 40.70f, 20.00f, 40.70f, -166.00f, -305.40f, -256.80f, -316.00f, -332.10f, 0.00f, -326.20f, 0.00f, 0.00f, -268.10f, -125.00f, -190.10f, -409.10f, -358.80f, 0.00f, -190.10f, -200.90f, -204.90f, 52.50f, -199.60f, -135.10f, -378.65f, 49.60f, 2.20f, -121.10f, -105.80f, -256.50f, -281.40f, -224.80f, -74.70f, -250.30f, -305.50f, -268.10f, -58.90f, -146.80f, -57.00f, -38.80f, -133.90f, -139.80f, -219.70f, -305.50f, -500.80f, -382.40f, -385.40f, -145.70f, 0.00f, -503.70f, -377.00f, -308.50f, -301.40f, -596.50f, -607.30f, -495.30f, -651.70f, -366.50f, 0.00f, -651.70f, -645.45f, -568.80f, -608.30f, -663.50f, -799.60f, -529.10f, -507.65f, -130.90f, -731.60f, -316.20f, -814.40f, -187.85f, -184.25f, -211.40f, -260.70f, -236.30f, -119.10f, -59.90f, -43.20f, -164.80f, -218.10f, -301.40f, -455.65f, -518.15f, -494.10f, -518.90f, -626.75f, -673.00f, -862.00f, -1190.20f, -962.80f, -904.20f, -930.70f, -930.70f, -1077.20f, -1101.55f, -1215.50f, -1320.80f, -1344.70f, -1022.95f, -810.30f, -1097.00f, -1489.50f, -1563.20f, -1600.00f, -1600.00f, -1500.40f, -1459.60f, -1360.20f, -1239.90f, -1233.70f, -1317.40f, -1343.60f, -1343.60f, -1243.40f, -1294.65f, -1257.45f, -1200.40f, -1168.65f, -1057.10f, -870.65f, 0.00f, -690.20f, -787.50f, -796.75f, -771.75f, -861.80f, -793.40f, 161.50f, 121.50f, 151.50f, 278.00f, 191.50f, 300.70f, 211.90f, 321.40f, 236.30f, 332.95f, 304.40f, 348.95f, 320.65f, 340.40f, 342.05f, 451.20f, 334.65f, 249.40f, 314.35f, 250.15f, 240.20f, 246.85f, 197.60f, 267.90f, 254.70f, 280.80f, 277.50f, 287.80f, 224.80f, 203.10f, 268.10f, 298.00f, 198.10f, 284.35f, 269.10f, 268.60f, 339.50f, 415.70f, 312.90f, 379.85f, 301.10f, 374.15f, 268.50f, 286.30f, 280.40f, 210.20f, 160.10f, 141.30f, 191.60f, 150.20f, 20.00f, 37.70f, -36.70f, -47.60f, -52.10f, -66.90f, -51.00f, 8.10f, -110.20f, -142.80f, -301.40f, -265.85f, -277.45f, -188.85f, -241.40f, -226.30f, -221.50f, -177.45f, -174.50f, -61.30f, 22.90f, 99.90f, 140.20f, 176.30f, 203.40f, 126.50f, 134.30f, 241.90f, 176.80f, 150.20f, 79.10f, 107.90f, -20.00f, 46.20f, -62.30f, 25.40f, -77.20f, -86.50f, 34.80f, -33.70f, 5.60f, -112.50f, -155.75f, -41.60f, -114.40f, -197.45f, -101.65f, -94.85f, -130.50f, -85.00f, -216.75f, -32.30f, -209.50f, -82.25f, -183.35f, -42.20f, -128.00f, -59.90f, -145.70f, -17.00f, -13.00f, -83.50f, -162.00f, -61.60f, -164.80f, -22.80f, -137.70f, 8.30f, 91.10f, 45.00f, -54.90f, 89.90f, 83.20f, 81.10f, -74.90f, 14.50f, -129.40f, -48.30f, -160.30f, -28.30f, -188.10f, -123.20f, -95.40f, 67.30f, -3.70f, 125.50f, 204.30f, 212.70f, 273.80f, 323.70f, 339.90f, 376.95f, 294.20f, 297.65f, 389.80f, 273.70f, 262.40f, 49.00f, 191.50f, 125.10f, 161.50f, 250.90f, 251.40f, 164.80f, 241.40f, 271.90f, 286.05f, 302.30f, 279.20f, 289.85f, 353.55f, 285.70f, 306.75f, 251.40f, 278.00f, 28.80f, 49.45f, 156.10f, 28.80f, -57.25f, -80.60f, -137.50f, -247.25f, -48.30f, 31.60f, 156.30f, 149.30f, 226.80f, 153.10f, 221.30f, 231.70f, 225.75f, 176.80f, 58.40f, 22.50f, -164.85f, -113.25f, -281.40f, -321.30f, -412.45f, -370.60f, -364.70f, -373.60f, -370.60f, -367.60f, -371.00f, -432.70f, -358.80f, -25.00f, -28.30f, -108.20f, -329.20f, -346.20f, -453.40f, -317.30f, -431.80f, -473.70f, -603.90f, -592.50f, 0.00f, 0.00f, 0.00f, 311.90f, 0.00f, 0.00f, 0.00f, -161.50f, -188.10f, -234.55f, 0.00f, 162.00f, 525.00f, 227.10f, 433.80f, 227.10f, 655.90f, 665.05f, 631.80f, 499.30f, 646.75f, 1446.80f, 935.90f, 945.50f, 1048.90f, 579.60f, 1536.70f, 1530.10f, 1076.45f, 684.70f, 670.90f, 1047.05f, 981.90f, 965.85f, 884.55f, 1370.20f, 1317.00f, 1320.30f, 911.35f, 834.00f, 431.30f, 546.60f, 905.15f, 881.25f, 756.10f, 374.40f, 581.00f, 307.00f, 581.45f, 690.05f, 339.50f, 342.00f, 530.60f, 787.50f, 819.10f, 256.70f, 546.45f, 442.90f, 591.10f, 424.60f, 584.40f, 409.60f
    };
    
    static constexpr float LED_Y[NUM_LEDS] = {
        -123.90f, -224.45f, -242.85f, -228.15f, -245.10f, -160.60f, -58.60f, -31.30f, 94.65f, 92.50f, 136.30f, 125.70f, 48.90f, 90.40f, 18.00f, -60.10f, -102.90f, -185.20f, -84.90f, -58.00f, -69.80f, 8.50f, 104.10f, 121.50f, 156.90f, 90.00f, -45.90f, -85.30f, -77.20f, -190.35f, -39.00f, -71.10f, -38.70f, -4.30f, 121.85f, 192.50f, 114.30f, 58.30f, -15.00f, -51.40f, -30.90f, -23.20f, -88.50f, 237.25f, -39.60f, 1.10f, -33.80f, 35.90f, 13.50f, 43.30f, 23.40f, 19.30f, -38.70f, -13.90f, -59.65f, -116.20f, 4.20f, 15.40f, 136.30f, 210.50f, 259.80f, 295.80f, 249.10f, 220.50f, 270.35f, 312.20f, 356.35f, 374.30f, 306.90f, 336.80f, 428.55f, 301.90f, 349.20f, 493.85f, 573.55f, 598.50f, 684.30f, 746.25f, 779.05f, 840.30f, 752.55f, 739.60f, 732.10f, 814.20f, 881.30f, 973.40f, 995.70f, 1050.10f, 1016.90f, 964.60f, 978.55f, 1013.10f, 846.30f, 993.20f, 998.60f, 807.10f, 809.20f, 831.60f, 913.70f, 0.00f, 799.30f, 744.60f, 821.70f, 903.70f, 824.20f, 892.10f, 743.30f, 736.30f, 735.20f, 748.25f, 763.20f, 771.30f, 543.20f, 588.25f, 683.05f, 791.00f, 568.25f, 735.70f, 710.90f, 764.00f, 304.40f, 402.95f, 596.65f, 270.50f, 304.40f, 294.90f, 496.50f, 465.20f, 594.20f, 436.05f, 488.25f, 559.75f, 680.20f, 600.30f, 726.55f, 870.40f, 824.00f, 746.95f, 747.50f, 783.45f, 727.35f, 1003.20f, 936.30f, 974.00f, 939.75f, 1134.65f, 1148.70f, 1215.55f, 1450.15f, 1600.00f, 1407.30f, 1408.50f, 1425.10f, 1411.65f, 1355.35f, 1340.20f, 1356.80f, 1323.20f, 1213.25f, 1181.05f, 1220.55f, 1227.00f, 1245.40f, 1147.40f, 1124.20f, 1105.95f, 1075.55f, 1026.50f, 1043.00f, 1021.50f, 923.20f, 902.90f, 873.85f, 933.35f, 976.60f, 843.80f, 757.25f, 784.80f, 670.70f, 807.65f, 794.35f, 815.40f, 867.30f, 720.05f, 623.95f, 669.80f, 703.40f, 843.70f, 691.45f, 722.80f, 771.20f, 838.60f, 695.20f, 519.50f, 596.30f, 535.75f, 584.95f, 463.95f, 430.85f, 312.35f, 394.05f, 313.90f, 295.35f, 99.30f, -76.90f, 1.20f, -5.05f, 174.90f, 0.00f, 247.20f, 0.00f, 48.70f, 159.50f, 246.90f, 159.50f, 208.40f, 285.50f, 468.20f, 59.50f, 272.30f, 357.60f, 473.30f, 446.30f, 617.70f, 653.40f, 730.50f, 773.90f, 778.50f, 571.05f, 823.20f, 823.20f, 712.50f, 613.50f, 532.50f, 466.00f, 64.30f, 465.60f, 545.30f, 156.90f, 411.10f, 380.70f, 355.00f, 71.20f, 148.80f, 0.00f, 355.00f, 338.60f, 244.40f, 195.50f, 123.50f, -115.80f, 256.80f, 112.80f, 74.10f, 28.30f, 7.70f, 232.00f, 218.60f, 64.30f, 32.50f, -74.60f, 159.50f, 156.90f, 10.30f, 0.50f, 151.80f, 185.20f, 249.50f, 223.80f, 237.90f, 177.50f, 145.20f, 147.80f, 64.65f, 165.90f, 158.80f, 167.20f, -101.30f, -119.40f, 0.00f, 0.00f, -12.90f, 0.00f, 0.00f, 100.50f, 16.00f, 403.90f, 416.70f, 233.65f, 353.70f, 411.60f, 352.40f, 373.90f, 344.70f, 342.10f, 396.10f, 330.20f, 386.20f, 393.60f, 368.20f, 173.25f, 20.00f, 126.00f, 115.45f, -175.50f, -13.40f, 16.00f, -12.90f, 34.60f, 292.60f, 218.95f, 99.90f, 90.60f, 424.40f, 388.40f, 58.30f, 185.35f, -3.90f, 175.85f, 370.40f, 411.20f, 155.75f, 185.25f, 203.70f, 103.30f, 280.40f, 204.40f, 342.10f, 365.30f, 194.20f, 40.80f, 5.20f, 23.10f, 33.40f, 203.45f, 179.95f, -158.20f, -450.20f, 112.00f, -188.50f, -349.80f, -326.20f, 279.90f, 252.20f, 247.20f, 0.00f, 0.00f, 28.40f, -83.50f, -123.30f, -133.80f, -398.70f, -835.65f, -846.25f, -903.25f, -948.85f, -791.70f, -856.90f, -929.00f, -938.90f, -1159.90f, -1448.70f, 0.00f, -1448.70f, -1119.80f, -1289.90f, -1345.10f, -1379.15f, -1406.50f, -1353.10f, -1329.90f, -1413.90f, -1300.20f, -1453.30f, -1462.40f, -1397.80f, -1339.10f, -1146.90f, -1121.50f, -1131.90f, -1326.80f, -1267.10f, -1331.80f, -1258.40f, -1154.30f, -1080.40f, -1097.45f, -1010.90f, -1096.60f, -1065.90f, -1120.90f, -1063.20f, -971.80f, -943.80f, -895.20f, -920.90f, -969.75f, -920.60f, -934.80f, -900.30f, -929.00f, -926.50f, -876.95f, -921.30f, -974.25f, -926.40f, -990.40f, -1101.90f, -1041.25f, -1008.40f, -975.35f, -1080.40f, -1060.70f, -1108.70f, -1057.20f, -877.75f, -871.15f, -976.20f, -1024.70f, -1083.00f, -1049.50f, -815.40f, -811.50f, -811.25f, -856.00f, -1094.50f, -1161.35f, -1148.90f, -923.90f, -928.65f, -1157.70f, -976.20f, -1131.25f, -1127.15f, -1187.80f, -1178.80f, -1219.85f, -1210.00f, -1244.80f, -1346.55f, -1341.80f, -1431.35f, -1352.15f, -1501.00f, -1600.00f, -1592.30f, -1259.70f, -1086.35f, -1066.70f, -1368.50f, -1381.60f, -1318.30f, -1386.50f, -1133.20f, -1118.00f, 0.00f, -1198.70f, -1309.30f, -1234.30f, -1260.10f, -1197.90f, -1093.10f, -1013.50f, -1094.90f, -1047.65f, -1103.40f, -1045.95f, -1025.35f, -1005.30f, -958.75f, -1052.10f, -511.50f, -476.70f, -880.80f, -928.55f, -792.20f, -980.10f, -935.00f, -854.00f, -763.75f, -515.95f, -937.85f, -854.00f, -772.05f, -821.55f, -837.25f, -795.25f, -722.80f, -712.50f, -674.00f, -556.95f, -572.60f, -605.40f, -228.90f, -317.20f, -218.80f, -428.35f, -358.00f, -344.70f, -322.15f, -235.00f, -234.20f, -102.90f, -5.10f, -100.90f, -128.30f, -183.70f, -252.60f, -108.40f, -105.90f, -170.50f, -235.55f, -207.80f, -362.70f, -362.30f, -210.30f, -360.10f, -259.10f, -286.05f, -309.30f, -356.30f, -303.50f, -456.50f, -420.95f, -405.75f, -311.50f, -401.80f, -508.70f, -463.60f, -398.70f, 0.00f, -426.70f, -456.50f, -374.80f, -361.05f, -334.30f, -515.80f, -411.70f, -476.40f, -404.30f, -416.70f, -494.15f, -613.30f, -672.80f, -448.90f, -490.40f, -432.20f, -439.90f, -448.70f, -456.50f, -435.90f, -478.90f, -385.50f, -257.60f, -227.70f, -212.80f, -148.10f, -185.40f, -163.10f, 80.05f, 185.20f, 108.60f, 223.40f, 252.10f, 299.30f, 246.90f, 329.30f, 258.10f, 240.40f, 313.80f, 263.45f, 340.50f, 424.10f, 328.00f, 443.20f, 236.70f, 182.60f, 192.90f, 223.80f, 148.80f, 221.20f, 139.30f, 192.00f, 208.40f, 115.80f, 200.60f, 112.80f, 161.50f, 144.40f, 114.50f, 205.40f, 166.60f, 85.30f, 148.40f, 140.70f, 59.20f, 69.50f, -7.70f, 12.90f, -48.90f, 20.60f, -70.90f, -84.90f, -87.50f, -92.60f, -90.90f, -79.70f, -10.30f, 5.10f, -23.50f, -24.40f, -56.35f, -53.40f, -51.20f, -57.25f, -22.30f, 50.20f, -25.70f, -19.30f, -118.70f, -86.35f, -63.25f, -63.60f, -93.40f, -73.90f, -64.75f, -74.05f, -71.90f, -50.70f, -178.65f, -191.65f, -196.00f, -225.40f, -146.60f, -285.45f, -269.00f, -225.80f, -268.80f, -228.50f, -231.40f, -243.70f, -237.70f, -251.95f, -265.00f, -247.55f, -194.45f, -205.60f, -194.25f, -202.35f, -78.50f, -66.80f, -98.40f, -140.70f, -98.40f, -103.00f, -138.20f, -36.20f, -195.00f, -187.90f, -191.70f, -197.50f, -247.20f, -242.60f, -232.70f, -278.30f, -219.90f, -233.55f, -170.15f, -102.90f, -74.60f, -41.20f, -82.90f, -35.90f, -75.70f, -28.80f, -56.10f, 89.25f, -43.70f, 92.25f, -53.70f, 119.80f, 77.50f, 103.45f, -43.70f, 98.55f, -49.10f, 88.10f, -43.70f, -31.30f, -91.70f, -2.55f, -84.90f, -86.60f, -190.55f, -237.95f, -93.00f, -79.40f, -140.60f, -85.30f, 2.60f, 34.30f, 46.70f, -10.30f, 28.30f, 138.90f, 195.90f, 143.75f, 180.10f, 152.70f, 130.50f, 117.20f, 126.45f, 134.10f, 183.90f, 162.40f, 159.10f, 168.00f, 64.70f, 56.60f, 126.00f, 128.60f, 130.30f, 223.80f, 192.90f, 169.80f, 72.00f, 2.60f, -32.45f, -36.00f, 90.60f, 113.00f, 23.40f, 190.65f, 219.20f, 301.00f, 283.30f, 266.60f, 144.10f, 115.80f, 134.10f, 108.00f, 64.30f, 30.90f, -42.80f, -59.20f, -62.85f, -7.70f, -7.70f, -314.20f, -164.20f, -205.80f, -192.90f, -243.10f, -265.00f, -280.40f, -301.00f, -223.80f, -223.80f, -219.50f, -265.00f, 28.90f, -180.10f, -181.00f, -187.80f, -180.10f, -184.30f, -246.90f, 316.00f, -148.30f, -137.55f, -97.15f, -50.20f, -55.35f, -38.05f, 27.80f, 244.80f, 1350.50f, 0.00f, 661.70f, 1600.00f, 854.00f, 949.20f, 1057.20f, 1136.60f, 1214.10f, 1255.30f, 1283.60f, 1304.20f, 0.00f, 1001.50f, 1347.90f, 1006.35f, 1422.10f, 973.30f, 1507.40f, 1245.00f, 960.00f, 1324.80f, 1335.90f, 1350.50f, 1350.50f, 1414.80f, 1430.60f, 1520.30f, 1561.80f, 1249.40f, 1492.00f, 0.00f, 1309.30f, 1309.30f, 1259.50f, 1305.50f, 1270.70f, 1002.45f, 923.70f, 896.55f, 1180.70f, 1245.00f, 1178.10f, 1232.20f, 1209.00f, 1250.20f, 728.80f, 833.45f, 1054.70f, 998.10f, 1036.70f, 1008.40f, 675.00f, 622.70f
    };
    
    static constexpr float LED_Z[NUM_LEDS] = {
        173.68f, 248.10f, 174.45f, 112.41f, 78.01f, 24.71f, 13.70f, 18.95f, 54.75f, 96.18f, 133.96f, 255.54f, 335.42f, 438.39f, 527.34f, 563.24f, 637.20f, 703.77f, 809.26f, 855.12f, 813.46f, 773.25f, 662.36f, 634.61f, 630.80f, 580.60f, 632.66f, 678.71f, 813.66f, 785.74f, 873.41f, 907.40f, 749.05f, 696.80f, 725.70f, 621.56f, 696.96f, 752.49f, 797.63f, 870.56f, 962.17f, 904.71f, 1012.57f, 1344.17f, 1221.60f, 1210.01f, 1299.48f, 1424.60f, 1524.07f, 1674.55f, 1512.30f, 1471.93f, 1347.57f, 1286.54f, 1201.97f, 1108.73f, 1088.00f, 1109.61f, 1178.18f, 1120.08f, 1086.80f, 1129.09f, 1295.27f, 1348.04f, 1443.45f, 1497.30f, 1607.45f, 1699.65f, 1842.50f, 1935.15f, 1953.00f, 2081.49f, 2247.38f, 2071.48f, 1997.31f, 1992.25f, 1952.07f, 2044.70f, 2099.11f, 2209.80f, 2355.79f, 2835.80f, 2749.04f, 2974.32f, 2995.96f, 3073.85f, 3132.35f, 3396.30f, 3370.30f, 2839.44f, 2879.30f, 3161.15f, 2342.97f, 2867.27f, 3113.41f, 2767.70f, 2831.12f, 2783.65f, 2856.85f, 2708.28f, 2879.49f, 2766.33f, 2794.50f, 2899.05f, 2630.00f, 2289.93f, 2077.77f, 2170.15f, 2166.79f, 2084.37f, 2063.96f, 2146.01f, 2208.62f, 2098.03f, 1988.23f, 2042.96f, 1984.50f, 2039.14f, 2052.42f, 2143.05f, 2077.40f, 2125.76f, 1960.68f, 2148.33f, 2057.70f, 1985.45f, 1827.30f, 1759.98f, 1658.96f, 1673.13f, 1604.46f, 1570.79f, 1592.24f, 1688.98f, 1788.05f, 1639.24f, 1565.59f, 1533.38f, 1587.02f, 1649.80f, 1758.80f, 1635.85f, 1647.74f, 1651.73f, 1535.29f, 1688.29f, 1740.64f, 1903.78f, 2138.61f, 2530.75f, 2446.15f, 2342.10f, 2167.21f, 2142.14f, 2168.11f, 1997.55f, 2153.50f, 2082.59f, 2119.03f, 2088.66f, 1874.29f, 1982.35f, 1973.92f, 2143.95f, 1685.13f, 1997.03f, 2018.21f, 1948.34f, 2060.70f, 1857.15f, 1940.22f, 1795.34f, 1918.37f, 1711.87f, 1760.98f, 1897.76f, 1793.03f, 1723.88f, 1744.61f, 1650.48f, 1562.18f, 1566.11f, 1645.73f, 1770.35f, 1719.56f, 1536.45f, 1634.20f, 1698.66f, 1616.80f, 1530.54f, 1540.87f, 1631.15f, 1775.02f, 1771.52f, 1612.74f, 1668.87f, 1778.48f, 1779.55f, 1692.90f, 1936.89f, 1997.07f, 1772.48f, 1834.67f, 1632.95f, 1700.36f, 1797.42f, 1769.68f, 1706.97f, 1736.00f, 1864.60f, 1827.88f, 1777.56f, 1845.83f, 1882.17f, 1809.72f, 1643.87f, 1664.66f, 1813.90f, 1890.54f, 1860.63f, 1843.77f, 1915.14f, 1907.15f, 1846.45f, 2011.64f, 2117.21f, 2064.08f, 2155.03f, 2204.30f, 2135.59f, 2009.89f, 1908.53f, 1984.97f, 1883.54f, 1765.01f, 1873.71f, 1729.30f, 1934.18f, 2583.21f, 1954.93f, 2295.46f, 2365.19f, 2210.71f, 2310.30f, 2150.28f, 2256.07f, 2164.66f, 2149.43f, 2257.12f, 2341.27f, 2300.76f, 2276.16f, 2348.42f, 2462.18f, 2487.12f, 2674.76f, 2596.13f, 2574.45f, 2710.74f, 2554.92f, 2765.49f, 2777.70f, 2446.84f, 2547.71f, 2678.59f, 2691.11f, 2660.22f, 2465.86f, 2262.40f, 2335.52f, 2255.89f, 2363.45f, 2205.76f, 2247.20f, 2104.38f, 2312.60f, 1892.96f, 1897.09f, 1870.60f, 1872.02f, 1873.41f, 2166.22f, 1958.13f, 2051.85f, 2418.73f, 2640.94f, 2195.90f, 2563.38f, 2781.50f, 2458.44f, 2546.31f, 2637.70f, 2709.54f, 2817.88f, 2901.08f, 2969.70f, 3068.47f, 3143.80f, 3266.63f, 3323.65f, 3318.83f, 3456.38f, 3308.83f, 3396.22f, 3529.67f, 3520.30f, 3435.80f, 3695.49f, 2787.65f, 3069.00f, 3524.34f, 3517.02f, 3470.20f, 3304.32f, 3273.68f, 3447.40f, 3345.45f, 3320.44f, 3139.81f, 3163.14f, 3238.40f, 3241.63f, 3048.98f, 3126.52f, 2809.30f, 2901.32f, 2936.70f, 2757.65f, 2676.91f, 2532.53f, 2203.81f, 2503.38f, 2778.96f, 2720.54f, 2621.76f, 2604.30f, 2617.56f, 2255.31f, 2485.50f, 2221.65f, 1810.65f, 2046.20f, 2218.05f, 2063.83f, 2098.43f, 1666.87f, 1543.37f, 1549.18f, 1540.89f, 1601.73f, 1827.80f, 1883.84f, 1999.10f, 1999.06f, 2007.55f, 1977.29f, 1945.76f, 1870.89f, 2069.73f, 1862.63f, 2147.90f, 2227.95f, 1893.70f, 2044.02f, 2024.78f, 2142.25f, 2214.06f, 2320.41f, 2558.23f, 2525.65f, 2616.91f, 2389.70f, 2390.34f, 2686.50f, 2569.16f, 2499.68f, 2368.73f, 2269.87f, 2252.33f, 2109.56f, 2111.35f, 2114.44f, 2365.58f, 2104.67f, 2119.75f, 2335.93f, 2248.40f, 2033.93f, 1967.85f, 2071.42f, 1877.00f, 2236.13f, 1907.93f, 1821.23f, 1888.38f, 2019.44f, 2217.35f, 2141.85f, 1916.70f, 1885.95f, 2166.22f, 2174.94f, 2300.03f, 2235.46f, 2533.96f, 2028.57f, 2340.41f, 2589.33f, 2394.66f, 2468.40f, 2477.96f, 2479.15f, 2603.53f, 2661.27f, 2715.72f, 2633.66f, 2472.43f, 2959.34f, 2615.13f, 2791.72f, 2614.67f, 2557.47f, 2475.18f, 2360.51f, 2411.81f, 2452.03f, 2652.65f, 2675.67f, 2395.61f, 2367.89f, 2485.25f, 2741.72f, 2566.59f, 2491.81f, 2263.22f, 2396.31f, 2420.42f, 2563.16f, 2912.08f, 2637.35f, 2948.43f, 2778.60f, 2731.03f, 2283.02f, 3125.14f, 3264.23f, 3037.92f, 2823.40f, 2459.13f, 2807.53f, 2794.28f, 2697.39f, 2686.62f, 2824.27f, 2656.53f, 2108.82f, 2779.37f, 2733.32f, 2523.99f, 2523.41f, 2450.83f, 2519.49f, 2233.40f, 2399.20f, 2302.30f, 2530.64f, 2118.13f, 2340.88f, 2234.39f, 2298.76f, 2216.21f, 2078.67f, 1998.49f, 2147.94f, 2185.01f, 1796.35f, 1611.77f, 1478.25f, 1944.91f, 2061.11f, 1800.40f, 1869.64f, 1809.44f, 1503.50f, 1818.28f, 1731.23f, 1652.69f, 1714.95f, 1617.35f, 1866.53f, 1785.08f, 1657.24f, 1704.51f, 1500.26f, 1571.65f, 1473.07f, 1483.34f, 1377.26f, 1249.80f, 1371.75f, 1171.71f, 1328.47f, 993.03f, 941.83f, 873.80f, 625.78f, 572.04f, 647.68f, 956.06f, 1030.56f, 1057.10f, 1353.13f, 1179.38f, 1331.98f, 1530.94f, 1301.15f, 1567.52f, 1495.09f, 1529.15f, 1668.98f, 1790.89f, 1761.60f, 2058.62f, 2028.11f, 2037.92f, 2076.08f, 2072.08f, 2085.88f, 2103.12f, 2073.27f, 2197.83f, 2108.98f, 2228.41f, 2286.64f, 2293.57f, 2508.20f, 2594.29f, 2338.02f, 2243.08f, 2210.65f, 2234.55f, 2144.77f, 2447.38f, 2333.36f, 2059.27f, 2101.55f, 2100.16f, 2064.36f, 2158.75f, 2095.63f, 2059.34f, 2126.94f, 2162.61f, 2117.14f, 2329.60f, 2154.26f, 2107.01f, 2097.10f, 1958.28f, 421.12f, 526.55f, 663.14f, 696.33f, 799.99f, 847.48f, 974.49f, 1047.79f, 1159.94f, 1233.72f, 1297.34f, 1377.86f, 1470.38f, 1543.63f, 1677.79f, 1711.44f, 1636.98f, 1576.78f, 1476.44f, 1389.57f, 1309.79f, 1212.20f, 1135.13f, 1070.08f, 925.71f, 893.48f, 771.41f, 700.51f, 576.12f, 516.13f, 421.86f, 362.74f, 276.43f, 239.04f, 120.36f, 78.42f, 66.67f, 131.36f, 143.00f, 219.64f, 227.90f, 343.20f, 445.55f, 464.28f, 536.57f, 608.17f, 677.46f, 764.39f, 867.09f, 970.37f, 1020.41f, 1129.92f, 1202.25f, 1337.21f, 1344.97f, 1445.49f, 1488.34f, 1553.68f, 1653.78f, 1715.18f, 1723.85f, 1599.43f, 1546.15f, 1460.53f, 1354.75f, 1251.86f, 1194.56f, 1103.19f, 1069.09f, 909.03f, 821.06f, 750.56f, 649.30f, 562.36f, 464.70f, 402.90f, 316.09f, 216.23f, 169.74f, 119.57f, 47.07f, 142.23f, 204.27f, 268.11f, 371.91f, 396.97f, 591.92f, 620.25f, 696.19f, 789.83f, 639.00f, 454.80f, 319.59f, 277.89f, 305.20f, 203.76f, 143.64f, 169.52f, 103.20f, 28.36f, 30.11f, 195.71f, 184.14f, 261.76f, 351.08f, 421.64f, 524.95f, 581.88f, 652.67f, 711.50f, 826.60f, 889.02f, 887.00f, 834.80f, 725.60f, 663.35f, 547.85f, 480.30f, 291.70f, 326.60f, 238.05f, 230.30f, 117.01f, 257.91f, 281.25f, 378.13f, 450.55f, 538.43f, 609.10f, 724.80f, 797.90f, 828.03f, 811.00f, 808.90f, 713.21f, 690.60f, 607.09f, 573.44f, 412.23f, 389.88f, 592.26f, 282.05f, 235.17f, 182.70f, 114.39f, 71.08f, 108.92f, 585.79f, 91.12f, 517.46f, 343.04f, 431.33f, 504.80f, 620.57f, 667.84f, 706.45f, 780.16f, 863.04f, 792.63f, 742.48f, 754.47f, 763.92f, 939.18f, 815.28f, 848.43f, 950.65f, 962.92f, 1035.58f, 1076.72f, 1032.97f, 1106.40f, 1119.07f, 1375.96f, 1064.64f, 1086.26f, 1125.54f, 1116.35f, 1129.43f, 1203.45f, 1053.39f, 1041.65f, 1041.19f, 1044.17f, 1129.97f, 1009.67f, 1071.81f, 1200.12f, 1172.37f, 1273.22f, 2040.03f, 2210.61f, 2205.20f, 2400.44f, 2348.12f, 2415.80f, 2536.40f, 2625.36f, 2829.83f, 2688.59f, 2600.29f, 2510.97f, 2725.46f, 2609.29f, 2442.57f, 2584.55f, 2384.69f, 2435.69f, 2531.96f, 2556.51f, 2573.45f, 2420.52f, 2355.08f, 2253.71f, 2038.03f, 2006.75f, 1904.77f, 1949.60f, 2427.45f, 2043.87f, 2295.60f, 2567.69f, 2224.89f, 2137.66f, 2245.50f, 2179.13f, 2504.80f, 2533.03f, 2748.10f, 2634.65f, 2820.84f, 2946.76f, 2904.87f, 2838.60f, 2762.83f, 2885.03f, 3176.89f, 2837.95f, 3027.21f, 2895.01f, 2834.01f, 2840.71f, 2790.80f, 2835.90f, 2852.10f, 3067.60f, 3120.73f, 3118.74f, 3203.92f, 2910.63f, 2745.09f, 2862.60f, 2825.45f, 2835.76f, 2795.53f, 2653.59f, 2748.44f, 2634.37f, 2549.75f, 2538.75f, 2323.75f, 2259.17f, 2402.11f, 2574.43f, 2836.80f, 2392.00f, 2329.50f, 2219.69f, 2238.50f, 2264.93f, 2546.05f, 2494.05f
    };
    
    // Pre-computed base colors (R, G, B as 0-255)
    static constexpr uint8_t LED_BASE_COLOR_R[NUM_LEDS] = {
        255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 229, 229, 229, 229, 178, 178, 255, 229, 229, 255, 255, 229, 255, 255, 255, 255, 255, 229, 255, 255, 229, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 229, 229, 229, 229, 229, 178, 178, 178, 178, 178, 178, 178, 178, 127, 255, 229, 178, 178, 178, 178, 229, 178, 178, 178, 229, 229, 229, 229, 229, 229, 255, 229, 229, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 229, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 229, 255, 229, 255, 255, 255, 229, 229, 229, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 229, 229, 255, 255, 229, 229, 255, 229, 229, 255, 255, 255, 255, 255, 229, 229, 229, 229, 229, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255
    };
    
    static constexpr uint8_t LED_BASE_COLOR_G[NUM_LEDS] = {
        204, 204, 204, 204, 204, 204, 204, 204, 204, 204, 204, 204, 204, 178, 178, 178, 178, 178, 178, 153, 178, 178, 178, 178, 178, 178, 178, 178, 178, 178, 153, 153, 178, 178, 178, 178, 178, 178, 178, 153, 153, 153, 153, 127, 153, 153, 127, 127, 127, 102, 127, 127, 127, 127, 153, 153, 153, 153, 153, 153, 153, 153, 127, 127, 127, 127, 127, 102, 102, 102, 102, 76, 76, 76, 102, 102, 102, 102, 76, 76, 76, 51, 51, 38, 38, 38, 38, 25, 25, 51, 38, 38, 76, 51, 38, 51, 51, 51, 51, 51, 38, 51, 51, 38, 51, 76, 76, 76, 76, 76, 76, 76, 76, 76, 102, 102, 102, 102, 102, 76, 76, 76, 102, 76, 102, 102, 102, 102, 102, 102, 127, 127, 127, 102, 102, 127, 127, 127, 127, 127, 102, 127, 127, 102, 127, 102, 102, 102, 76, 51, 76, 76, 76, 76, 76, 102, 76, 76, 76, 76, 102, 102, 102, 76, 102, 102, 102, 102, 76, 102, 102, 102, 102, 102, 102, 102, 102, 102, 102, 102, 127, 127, 127, 102, 102, 127, 127, 102, 127, 127, 127, 127, 102, 102, 127, 102, 102, 102, 102, 102, 102, 102, 102, 127, 102, 102, 102, 102, 102, 102, 102, 102, 102, 102, 102, 127, 102, 102, 102, 102, 102, 102, 102, 102, 102, 76, 76, 76, 76, 76, 102, 102, 102, 102, 102, 102, 102, 102, 51, 102, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 51, 51, 51, 51, 51, 51, 51, 51, 76, 51, 51, 51, 51, 76, 76, 76, 76, 76, 76, 76, 76, 76, 102, 102, 102, 102, 102, 76, 102, 102, 76, 51, 76, 51, 51, 76, 51, 51, 51, 51, 38, 38, 38, 38, 38, 25, 25, 25, 25, 25, 25, 25, 25, 12, 51, 38, 25, 25, 25, 25, 38, 25, 25, 25, 38, 38, 38, 38, 38, 38, 51, 38, 38, 51, 51, 51, 76, 51, 51, 51, 51, 51, 51, 76, 51, 76, 102, 102, 76, 76, 76, 102, 127, 127, 127, 127, 102, 102, 102, 102, 102, 102, 102, 102, 76, 102, 76, 76, 102, 102, 102, 76, 76, 76, 51, 51, 51, 76, 76, 51, 51, 51, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 102, 102, 76, 102, 76, 102, 102, 102, 102, 76, 76, 102, 102, 76, 76, 76, 76, 51, 102, 76, 51, 76, 51, 51, 51, 51, 51, 51, 51, 51, 38, 51, 51, 51, 51, 51, 76, 76, 76, 51, 51, 76, 76, 51, 51, 51, 51, 76, 76, 76, 51, 38, 51, 38, 51, 51, 76, 38, 38, 38, 51, 76, 51, 51, 51, 51, 51, 51, 76, 51, 51, 51, 51, 76, 51, 76, 76, 76, 51, 76, 76, 76, 76, 76, 76, 102, 76, 76, 102, 127, 127, 102, 76, 102, 102, 102, 127, 102, 102, 102, 102, 127, 102, 102, 102, 102, 127, 127, 127, 127, 127, 127, 127, 153, 127, 153, 153, 153, 178, 178, 178, 153, 153, 153, 127, 153, 127, 127, 127, 127, 127, 127, 102, 102, 102, 102, 102, 102, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 51, 51, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 76, 102, 204, 178, 178, 178, 178, 153, 153, 153, 153, 153, 127, 127, 127, 127, 102, 102, 127, 127, 127, 127, 127, 153, 153, 153, 153, 153, 178, 178, 178, 178, 204, 204, 204, 204, 204, 204, 204, 204, 204, 204, 204, 204, 178, 178, 178, 178, 178, 178, 153, 153, 153, 153, 153, 127, 127, 127, 127, 127, 102, 102, 102, 127, 127, 127, 127, 127, 153, 153, 153, 153, 178, 178, 178, 178, 178, 204, 204, 204, 204, 204, 204, 204, 204, 204, 204, 204, 178, 178, 178, 178, 178, 178, 204, 204, 204, 204, 204, 204, 204, 204, 204, 204, 204, 204, 204, 204, 178, 178, 178, 178, 178, 153, 153, 153, 178, 178, 178, 178, 204, 204, 204, 204, 204, 204, 204, 204, 178, 178, 178, 178, 178, 178, 178, 178, 178, 178, 178, 178, 204, 204, 178, 204, 204, 204, 204, 204, 204, 178, 204, 178, 204, 178, 178, 178, 178, 178, 178, 153, 178, 178, 178, 178, 153, 178, 153, 153, 153, 153, 153, 153, 153, 153, 127, 153, 153, 153, 153, 153, 153, 153, 153, 153, 153, 153, 153, 153, 153, 153, 127, 102, 76, 76, 76, 76, 76, 51, 51, 51, 51, 51, 51, 51, 51, 76, 51, 76, 76, 51, 51, 51, 76, 76, 76, 102, 102, 102, 102, 76, 102, 76, 51, 76, 76, 76, 76, 51, 51, 51, 51, 51, 38, 38, 51, 51, 38, 38, 51, 38, 38, 51, 51, 51, 51, 51, 38, 38, 38, 38, 38, 51, 51, 51, 51, 51, 51, 51, 51, 51, 51, 76, 76, 76, 51, 51, 76, 76, 76, 76, 76, 51, 51
    };
    
    static constexpr uint8_t LED_BASE_COLOR_B[NUM_LEDS] = {
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
    };
    
    // Pre-computed flicker parameters
    static constexpr float LED_FLICKER_FREQ[NUM_LEDS] = {
        0.950f, 1.180f, 1.093f, 1.039f, 0.862f, 0.862f, 0.823f, 1.146f, 1.040f, 1.083f, 0.808f, 1.188f, 1.133f, 0.885f, 0.873f, 0.873f, 0.922f, 1.010f, 0.973f, 0.916f, 1.045f, 0.856f, 0.917f, 0.947f, 0.982f, 1.114f, 0.880f, 1.006f, 1.037f, 0.819f, 1.043f, 0.868f, 0.826f, 1.180f, 1.186f, 1.123f, 0.922f, 0.839f, 1.074f, 0.976f, 0.849f, 0.998f, 0.814f, 1.164f, 0.904f, 1.065f, 0.925f, 1.008f, 1.019f, 0.874f, 1.188f, 1.110f, 1.176f, 1.158f, 1.039f, 1.169f, 0.835f, 0.878f, 0.818f, 0.930f, 0.955f, 0.909f, 1.131f, 0.943f, 0.912f, 1.017f, 0.856f, 1.121f, 0.830f, 1.195f, 1.109f, 0.879f, 0.802f, 1.126f, 1.083f, 1.092f, 1.109f, 0.830f, 0.943f, 0.846f, 1.145f, 1.049f, 0.932f, 0.825f, 0.924f, 0.930f, 1.092f, 1.055f, 1.155f, 0.989f, 0.848f, 1.085f, 1.104f, 1.025f, 1.108f, 0.998f, 1.009f, 0.971f, 0.810f, 0.843f, 0.813f, 1.055f, 0.926f, 1.003f, 1.163f, 0.900f, 0.964f, 1.102f, 0.892f, 0.831f, 0.916f, 0.864f, 1.172f, 1.123f, 1.053f, 1.149f, 1.121f, 0.875f, 1.157f, 1.016f, 1.123f, 1.158f, 0.927f, 0.844f, 0.891f, 0.971f, 1.127f, 1.144f, 0.803f, 1.004f, 0.967f, 0.889f, 0.848f, 0.935f, 1.177f, 0.929f, 1.008f, 1.081f, 0.945f, 1.189f, 1.185f, 0.901f, 0.999f, 0.920f, 0.914f, 0.815f, 1.044f, 1.001f, 0.821f, 0.911f, 1.163f, 0.896f, 0.858f, 0.996f, 1.194f, 0.897f, 1.069f, 1.105f, 0.895f, 1.091f, 0.947f, 1.053f, 1.053f, 1.014f, 0.836f, 1.134f, 0.928f, 0.875f, 0.816f, 1.036f, 1.071f, 0.807f, 1.005f, 0.891f, 1.058f, 0.870f, 1.076f, 0.955f, 1.175f, 0.855f, 0.936f, 0.845f, 1.170f, 1.151f, 0.903f, 1.064f, 1.127f, 1.022f, 1.012f, 0.897f, 0.837f, 1.159f, 1.160f, 1.053f, 0.936f, 0.940f, 1.090f, 1.159f, 1.155f, 1.112f, 1.057f, 0.834f, 0.865f, 1.159f, 1.043f, 0.804f, 0.841f, 1.065f, 0.802f, 0.864f, 1.019f, 1.077f, 1.061f, 0.890f, 1.085f, 0.895f, 0.930f, 1.099f, 1.060f, 1.140f, 1.063f, 1.027f, 0.837f, 0.947f, 0.906f, 0.898f, 1.189f, 0.957f, 1.157f, 1.052f, 1.118f, 1.001f, 1.031f, 0.997f, 0.878f, 1.089f, 0.912f, 0.810f, 1.058f, 0.871f, 1.176f, 1.182f, 1.166f, 0.948f, 0.806f, 1.171f, 0.971f, 1.187f, 1.185f, 1.141f, 0.918f, 0.954f, 1.140f, 0.927f, 0.868f, 1.023f, 1.174f, 1.078f, 1.028f, 0.839f, 1.046f, 1.196f, 0.856f, 1.007f, 1.151f, 1.096f, 1.079f, 1.081f, 0.944f, 0.917f, 1.124f, 1.124f, 1.147f, 1.165f, 1.005f, 1.001f, 1.119f, 1.060f, 1.081f, 1.118f, 1.156f, 0.935f, 0.950f, 0.838f, 1.031f, 0.814f, 0.986f, 1.017f, 0.915f, 1.036f, 0.812f, 0.815f, 1.129f, 0.944f, 0.851f, 1.009f, 1.108f, 0.886f, 1.049f, 0.834f, 0.821f, 1.013f, 1.016f, 1.055f, 1.090f, 1.190f, 1.007f, 0.929f, 1.118f, 0.908f, 0.976f, 0.831f, 0.810f, 1.185f, 1.134f, 1.078f, 0.964f, 0.869f, 0.863f, 0.900f, 1.020f, 1.086f, 1.064f, 0.912f, 1.182f, 1.095f, 1.022f, 1.045f, 0.968f, 0.899f, 0.942f, 1.103f, 0.806f, 0.846f, 0.818f, 0.816f, 1.142f, 1.081f, 0.990f, 0.839f, 0.997f, 0.989f, 0.869f, 0.974f, 0.959f, 1.046f, 1.054f, 0.818f, 0.950f, 1.050f, 1.001f, 1.143f, 1.063f, 0.865f, 0.828f, 1.057f, 0.811f, 1.034f, 1.176f, 1.030f, 0.955f, 1.057f, 0.983f, 1.018f, 1.177f, 0.954f, 1.184f, 1.162f, 0.878f, 0.828f, 0.840f, 0.807f, 0.838f, 1.073f, 0.828f, 0.928f, 1.138f, 0.809f, 1.126f, 0.913f, 0.847f, 1.079f, 1.052f, 1.151f, 1.094f, 1.121f, 0.913f, 0.871f, 1.100f, 1.123f, 1.196f, 0.965f, 0.949f, 1.111f, 0.936f, 1.172f, 1.143f, 0.972f, 1.100f, 1.102f, 0.841f, 1.161f, 1.002f, 1.131f, 0.928f, 1.158f, 0.956f, 0.804f, 1.162f, 0.837f, 0.928f, 1.180f, 1.180f, 1.029f, 1.053f, 0.979f, 0.917f, 0.931f, 1.069f, 1.101f, 1.117f, 1.116f, 0.836f, 0.998f, 0.823f, 1.020f, 0.977f, 1.155f, 0.940f, 0.847f, 0.857f, 1.105f, 1.047f, 0.840f, 0.834f, 1.080f, 0.829f, 1.129f, 1.082f, 0.833f, 0.834f, 1.195f, 0.950f, 0.948f, 1.125f, 1.179f, 1.194f, 1.101f, 0.951f, 0.833f, 1.111f, 1.023f, 0.970f, 1.163f, 0.844f, 0.997f, 0.805f, 0.987f, 0.823f, 0.848f, 0.847f, 1.060f, 1.098f, 1.033f, 1.185f, 0.950f, 0.914f, 1.147f, 0.889f, 1.185f, 0.805f, 1.188f, 0.817f, 1.156f, 1.011f, 1.197f, 0.830f, 1.022f, 1.188f, 1.009f, 1.052f, 1.078f, 0.982f, 1.051f, 1.034f, 1.160f, 0.818f, 0.912f, 1.180f, 1.156f, 0.982f, 1.048f, 0.911f, 0.875f, 0.985f, 0.941f, 1.033f, 0.831f, 1.190f, 1.194f, 1.079f, 1.014f, 0.924f, 1.126f, 1.074f, 0.865f, 1.164f, 1.129f, 1.180f, 1.090f, 1.045f, 0.967f, 1.173f, 1.146f, 0.818f, 0.811f, 0.951f, 1.124f, 1.195f, 0.860f, 1.038f, 0.952f, 1.188f, 1.137f, 1.135f, 0.987f, 0.966f, 0.909f, 0.823f, 1.146f, 1.125f, 1.200f, 1.199f, 1.022f, 1.108f, 1.178f, 1.140f, 0.899f, 0.980f, 0.852f, 1.182f, 1.042f, 0.891f, 1.069f, 1.047f, 0.943f, 0.845f, 1.069f, 1.008f, 1.109f, 1.008f, 1.141f, 1.021f, 1.024f, 1.151f, 0.961f, 0.854f, 0.812f, 1.102f, 1.048f, 1.082f, 0.885f, 0.855f, 0.806f, 0.940f, 1.036f, 0.957f, 0.975f, 1.162f, 0.939f, 1.006f, 1.113f, 0.959f, 1.049f, 1.145f, 1.180f, 0.859f, 1.171f, 0.997f, 0.903f, 0.984f, 1.192f, 0.997f, 0.932f, 1.053f, 0.896f, 0.830f, 0.852f, 0.851f, 0.861f, 0.856f, 1.056f, 0.873f, 0.938f, 1.159f, 0.990f, 1.067f, 0.869f, 0.877f, 0.816f, 0.868f, 0.911f, 0.871f, 0.835f, 0.848f, 0.984f, 0.883f, 0.946f, 1.001f, 1.076f, 0.816f, 1.120f, 1.051f, 0.833f, 1.149f, 1.168f, 0.824f, 0.911f, 1.122f, 1.099f, 0.874f, 0.884f, 0.948f, 0.994f, 1.047f, 0.948f, 0.985f, 1.099f, 0.815f, 0.901f, 1.085f, 1.158f, 1.005f, 1.013f, 0.843f, 0.979f, 1.013f, 0.897f, 0.908f, 0.951f, 0.808f, 0.929f, 0.885f, 0.931f, 0.848f, 1.156f, 1.037f, 1.072f, 1.116f, 0.999f, 0.835f, 1.015f, 1.035f, 1.098f, 0.973f, 0.851f, 0.914f, 0.945f, 1.058f, 1.028f, 0.942f, 1.195f, 1.042f, 0.895f, 0.841f, 0.861f, 0.898f, 0.864f, 0.875f, 0.914f, 0.869f, 1.159f, 0.832f, 1.010f, 0.964f, 1.193f, 0.845f, 0.959f, 1.188f, 1.146f, 1.127f, 0.903f, 0.868f, 1.067f, 1.172f, 1.023f, 1.029f, 0.912f, 1.108f, 0.875f, 0.929f, 0.970f, 1.003f, 0.897f, 0.846f, 1.044f, 0.915f, 1.032f, 0.862f, 0.992f, 1.013f, 0.821f, 0.935f, 0.854f, 0.825f, 1.196f, 0.929f, 1.124f, 0.902f, 1.073f, 1.104f, 1.038f, 0.989f, 0.965f, 0.940f, 1.172f, 1.132f, 1.186f, 0.850f, 1.092f, 1.175f, 0.872f, 0.827f, 1.096f, 1.030f, 1.137f, 0.856f, 1.118f, 0.881f, 0.865f, 0.866f, 1.126f, 1.066f, 1.009f, 0.944f, 1.151f, 0.957f, 1.127f, 0.976f, 0.951f, 0.985f, 0.921f, 1.099f, 1.001f, 0.893f, 1.160f, 0.954f, 1.017f, 1.163f, 1.050f, 0.847f, 1.176f, 1.051f, 0.934f, 0.856f, 1.118f, 1.048f, 1.013f, 1.158f, 1.115f, 0.861f, 0.925f, 0.899f, 1.098f, 0.813f, 1.028f, 1.105f, 1.151f, 0.937f, 1.129f, 0.844f, 1.139f, 0.851f, 0.959f, 1.119f, 0.860f, 0.892f, 1.089f, 1.088f, 1.056f, 1.078f, 1.017f, 0.901f, 0.938f, 0.873f, 1.163f, 1.033f, 0.960f, 0.985f, 1.179f, 0.861f, 1.034f, 1.002f, 1.045f, 0.807f, 1.149f, 1.173f, 1.026f, 1.079f, 1.169f, 1.083f, 0.861f, 1.031f, 1.043f, 0.970f, 1.095f, 1.174f, 1.170f, 0.980f, 0.845f, 1.194f, 1.136f, 0.850f, 1.168f, 1.148f, 1.008f, 1.037f, 0.960f, 0.822f, 0.934f, 1.121f, 0.802f, 0.933f, 0.959f, 1.015f, 1.168f, 0.939f, 0.939f, 1.095f, 0.981f
    };
    
    static constexpr float LED_FLICKER_PHASE[NUM_LEDS] = {
        1.411f, 2.843f, 0.885f, 1.108f, 3.131f, 2.632f, 5.748f, 2.277f, 3.648f, 3.973f, 0.082f, 4.169f, 1.119f, 6.039f, 0.934f, 2.605f, 0.536f, 6.264f, 3.155f, 3.741f, 0.421f, 4.712f, 1.319f, 5.643f, 1.289f, 1.198f, 0.230f, 2.966f, 3.549f, 0.413f, 4.873f, 2.848f, 3.295f, 2.769f, 2.518f, 3.516f, 0.975f, 1.143f, 5.415f, 5.945f, 2.346f, 1.701f, 4.046f, 2.568f, 0.160f, 0.981f, 4.499f, 4.140f, 0.170f, 1.395f, 1.452f, 4.222f, 0.124f, 0.654f, 5.026f, 1.122f, 4.101f, 1.497f, 0.625f, 1.528f, 4.538f, 5.376f, 5.216f, 2.496f, 4.198f, 1.288f, 1.842f, 5.632f, 0.082f, 0.537f, 1.306f, 0.167f, 1.140f, 3.663f, 2.648f, 5.609f, 5.136f, 2.148f, 1.630f, 2.386f, 3.709f, 1.684f, 3.922f, 2.572f, 3.469f, 2.740f, 1.850f, 5.959f, 4.798f, 0.880f, 5.457f, 3.063f, 5.621f, 5.026f, 2.672f, 0.141f, 1.688f, 3.403f, 3.980f, 1.620f, 0.876f, 5.246f, 6.185f, 3.303f, 1.079f, 1.711f, 0.116f, 5.745f, 0.740f, 3.622f, 1.722f, 3.482f, 4.093f, 5.213f, 1.297f, 0.069f, 0.860f, 5.655f, 5.491f, 3.754f, 3.773f, 4.179f, 1.102f, 5.745f, 2.631f, 2.407f, 3.260f, 0.295f, 1.045f, 4.637f, 0.520f, 3.790f, 1.542f, 2.446f, 1.814f, 2.235f, 4.518f, 1.867f, 3.559f, 2.991f, 4.170f, 5.886f, 4.603f, 1.351f, 0.196f, 1.648f, 3.739f, 0.323f, 3.119f, 3.750f, 2.100f, 4.844f, 0.670f, 0.472f, 4.575f, 3.113f, 4.325f, 2.732f, 1.548f, 5.147f, 5.023f, 4.365f, 1.710f, 3.709f, 2.268f, 0.575f, 5.764f, 0.860f, 5.971f, 2.802f, 1.163f, 3.405f, 5.485f, 4.601f, 5.068f, 4.139f, 4.350f, 5.336f, 1.569f, 3.075f, 1.390f, 6.206f, 5.932f, 0.248f, 4.433f, 5.814f, 1.135f, 3.569f, 5.752f, 0.213f, 4.382f, 1.868f, 5.808f, 6.101f, 5.933f, 2.980f, 5.416f, 5.306f, 2.005f, 5.208f, 0.233f, 3.746f, 1.445f, 0.758f, 0.484f, 4.375f, 2.135f, 4.554f, 0.411f, 1.981f, 3.390f, 4.968f, 2.003f, 3.933f, 5.567f, 3.870f, 1.464f, 0.153f, 5.467f, 0.134f, 5.496f, 3.323f, 5.900f, 5.019f, 6.270f, 2.204f, 4.820f, 2.525f, 3.015f, 3.943f, 5.489f, 6.183f, 4.827f, 2.625f, 2.647f, 4.634f, 1.500f, 0.694f, 2.228f, 1.805f, 1.862f, 1.468f, 0.264f, 0.112f, 6.206f, 2.688f, 2.415f, 4.270f, 1.371f, 5.969f, 4.941f, 0.562f, 2.624f, 5.524f, 5.936f, 2.937f, 3.854f, 1.050f, 6.228f, 1.456f, 5.923f, 4.082f, 3.819f, 3.221f, 1.449f, 1.109f, 1.385f, 1.171f, 4.898f, 2.200f, 0.363f, 6.089f, 5.553f, 5.829f, 6.251f, 1.093f, 2.490f, 4.764f, 4.373f, 0.967f, 5.126f, 1.410f, 1.406f, 3.374f, 3.726f, 3.645f, 0.575f, 5.513f, 1.669f, 0.814f, 5.584f, 6.005f, 5.417f, 5.086f, 4.117f, 3.461f, 0.547f, 2.566f, 2.342f, 1.632f, 4.545f, 3.116f, 0.509f, 1.383f, 4.293f, 0.478f, 5.348f, 3.111f, 3.020f, 3.722f, 5.182f, 2.185f, 4.260f, 3.555f, 1.678f, 5.521f, 5.010f, 4.137f, 5.344f, 5.449f, 4.451f, 5.259f, 4.382f, 4.273f, 3.887f, 4.729f, 0.997f, 5.535f, 5.478f, 0.184f, 5.189f, 0.810f, 2.106f, 4.672f, 1.010f, 5.139f, 5.228f, 3.189f, 0.040f, 1.804f, 3.876f, 6.165f, 3.970f, 1.632f, 3.984f, 3.393f, 4.900f, 0.672f, 4.782f, 3.401f, 6.051f, 2.148f, 3.975f, 5.856f, 0.644f, 5.889f, 4.322f, 0.426f, 1.891f, 4.450f, 0.423f, 3.658f, 2.173f, 3.901f, 0.287f, 5.476f, 6.117f, 6.088f, 4.710f, 0.817f, 4.764f, 0.154f, 0.139f, 2.033f, 3.070f, 4.841f, 4.293f, 2.802f, 1.719f, 6.265f, 2.678f, 2.836f, 1.028f, 4.994f, 4.359f, 1.387f, 0.518f, 4.276f, 4.112f, 1.717f, 5.974f, 0.949f, 2.716f, 5.929f, 2.637f, 4.012f, 2.498f, 1.723f, 6.183f, 2.572f, 5.618f, 1.445f, 1.339f, 0.196f, 4.095f, 2.316f, 5.431f, 2.973f, 6.083f, 1.166f, 5.458f, 4.880f, 4.844f, 5.308f, 4.782f, 3.935f, 0.825f, 0.204f, 5.786f, 3.875f, 5.005f, 3.025f, 0.737f, 0.787f, 4.308f, 2.704f, 1.260f, 3.089f, 0.403f, 3.657f, 1.690f, 5.011f, 1.950f, 2.860f, 0.073f, 0.455f, 2.466f, 3.016f, 3.770f, 1.833f, 4.367f, 5.404f, 4.900f, 0.249f, 3.019f, 0.659f, 1.521f, 6.199f, 0.895f, 3.135f, 3.884f, 4.414f, 3.516f, 0.061f, 2.051f, 3.253f, 0.552f, 2.203f, 0.209f, 0.494f, 2.494f, 0.834f, 3.566f, 4.332f, 5.030f, 1.258f, 1.052f, 0.657f, 3.999f, 4.439f, 0.198f, 5.882f, 0.327f, 3.401f, 4.455f, 5.472f, 4.487f, 5.037f, 2.133f, 5.120f, 0.503f, 5.622f, 3.441f, 5.135f, 2.842f, 4.044f, 3.307f, 4.597f, 0.513f, 0.379f, 1.553f, 1.002f, 5.478f, 1.377f, 6.132f, 2.117f, 1.144f, 4.962f, 4.139f, 3.130f, 3.489f, 4.519f, 1.435f, 6.260f, 6.125f, 4.086f, 1.254f, 4.274f, 0.454f, 0.193f, 1.619f, 2.907f, 5.456f, 4.569f, 4.667f, 2.673f, 2.174f, 2.331f, 6.206f, 0.252f, 5.448f, 3.636f, 2.756f, 4.557f, 3.058f, 5.488f, 5.659f, 2.650f, 1.739f, 3.722f, 5.733f, 1.324f, 3.914f, 3.968f, 4.606f, 0.827f, 4.498f, 5.712f, 1.129f, 1.493f, 6.103f, 1.137f, 5.368f, 3.093f, 1.553f, 5.471f, 2.798f, 3.235f, 2.257f, 3.726f, 1.027f, 2.457f, 6.091f, 1.622f, 4.126f, 2.043f, 4.860f, 0.822f, 6.094f, 2.851f, 1.483f, 0.462f, 1.067f, 3.266f, 2.117f, 5.208f, 2.707f, 1.563f, 3.878f, 4.441f, 1.050f, 1.053f, 0.230f, 4.627f, 4.171f, 2.982f, 5.304f, 5.062f, 3.678f, 5.456f, 1.293f, 0.703f, 1.695f, 0.359f, 3.337f, 5.885f, 0.247f, 0.767f, 2.841f, 5.868f, 1.986f, 3.187f, 0.261f, 0.932f, 6.199f, 6.064f, 0.031f, 5.980f, 4.016f, 5.453f, 2.857f, 3.240f, 3.072f, 4.190f, 0.877f, 0.188f, 1.935f, 4.428f, 1.268f, 4.231f, 6.094f, 0.590f, 4.226f, 2.788f, 5.455f, 1.113f, 4.352f, 5.266f, 5.935f, 4.293f, 3.124f, 3.882f, 5.459f, 3.585f, 0.191f, 5.849f, 4.332f, 4.251f, 1.355f, 4.140f, 2.475f, 4.092f, 0.670f, 4.133f, 6.280f, 0.303f, 6.140f, 2.557f, 5.471f, 4.916f, 3.563f, 4.640f, 5.520f, 2.539f, 2.055f, 4.195f, 5.076f, 4.790f, 5.013f, 2.737f, 5.139f, 0.755f, 3.421f, 0.036f, 2.039f, 2.303f, 2.489f, 4.370f, 2.441f, 2.819f, 1.493f, 2.345f, 1.428f, 0.460f, 3.792f, 4.199f, 3.892f, 2.912f, 2.386f, 5.424f, 3.261f, 3.011f, 0.161f, 2.144f, 2.389f, 2.506f, 3.645f, 3.353f, 3.820f, 4.806f, 5.108f, 4.512f, 6.004f, 0.115f, 1.230f, 0.048f, 4.068f, 5.642f, 1.530f, 5.825f, 0.379f, 5.871f, 2.209f, 0.637f, 3.053f, 1.613f, 1.790f, 1.931f, 5.046f, 3.388f, 1.956f, 3.835f, 4.500f, 1.713f, 2.598f, 0.766f, 1.138f, 4.280f, 1.140f, 3.300f, 4.455f, 0.672f, 3.565f, 1.612f, 6.050f, 3.038f, 5.064f, 3.457f, 0.273f, 3.978f, 5.978f, 3.780f, 5.147f, 5.556f, 1.433f, 1.332f, 3.839f, 2.583f, 5.277f, 5.655f, 2.221f, 1.488f, 4.904f, 1.727f, 5.169f, 2.662f, 4.194f, 0.600f, 3.920f, 2.839f, 3.686f, 1.056f, 4.630f, 5.421f, 1.362f, 0.601f, 0.149f, 4.034f, 3.814f, 3.435f, 1.457f, 2.456f, 3.735f, 3.121f, 6.206f, 0.857f, 4.368f, 2.540f, 2.690f, 4.509f, 4.351f, 6.228f, 0.807f, 0.654f, 4.551f, 3.634f, 1.723f, 0.499f, 0.538f, 5.618f, 1.206f, 2.032f, 1.424f, 2.231f, 0.436f, 3.261f, 0.425f, 5.029f, 1.468f, 3.393f, 5.530f, 4.090f, 3.349f, 2.038f, 2.092f, 4.207f, 6.246f, 4.158f, 3.505f, 4.591f, 2.923f, 0.378f, 3.533f, 6.017f, 1.101f, 4.335f, 1.263f, 3.367f, 0.607f, 2.830f, 4.751f, 2.184f, 4.178f, 4.998f, 5.826f, 1.474f, 2.509f, 0.958f, 6.236f, 5.825f, 3.393f, 5.291f, 3.273f, 3.918f, 0.560f, 4.746f, 0.802f, 5.190f, 4.914f, 4.453f, 0.227f, 1.905f, 1.653f, 2.263f, 0.551f, 5.887f, 3.480f, 1.920f, 2.494f, 2.810f
    };
    
    // Jet colors (R, G, B as 0-255)
    static constexpr uint8_t JET_COLORS[4][3] = {
        {255, 229, 0},
        {255, 178, 0},
        {255, 127, 0},
        {255, 76, 0}
    };
    
    // Runtime state
    uint32_t _lastLoopMs = 0;
    float _maxBrightnessPC = 100.0f;
    float _baseHeightMm = 800.0f;
    float _flameSpeed = 600.0f;
    float _jetSpeed = 1500.0f;
    float _jetSpawnRate = 3.0f;
    
    // Flame tongue state
    float _flamePos[NUM_FLAMES];
    bool _flameActive[NUM_FLAMES];
    float _flameIntensity[NUM_FLAMES];
    float _flameHeight[NUM_FLAMES];
    float _flameWidth[NUM_FLAMES];
    float _flameXOffset[NUM_FLAMES];
    float _flameYOffset[NUM_FLAMES];
    
    // Jet state
    bool _jetActive[NUM_JETS];
    float _jetPos[NUM_JETS];
    float _jetMaxHeight[NUM_JETS];
    float _jetWidth[NUM_JETS];
    float _jetXOffset[NUM_JETS];
    float _jetYOffset[NUM_JETS];
    float _jetBrightness[NUM_JETS];
    
    // LED color buffer (R, G, B as 0-255)
    uint8_t _ledR[NUM_LEDS] = {};
    uint8_t _ledG[NUM_LEDS] = {};
    uint8_t _ledB[NUM_LEDS] = {};
    
    // Helper: random float in range [0, max]
    float random(float max) {
        return (rand() / (float)RAND_MAX) * max;
    }
    
    // Helper: clamp value
    float clamp(float v, float min, float max) {
        return v < min ? min : (v > max ? max : v);
    }
    
    // Helper: max of two uint8_t
    uint8_t maxU8(uint8_t a, uint8_t b) {
        return a > b ? a : b;
    }
    
    void updateBaseFireEdge(float elapsed, float dt)
    {
        // Base fire edge will be computed per-LED during render
        // This keeps the code simpler and avoids storing per-LED edge heights
    }
    
    void updateFlames(float elapsed, float dt)
    {
        float distance = dt * _flameSpeed;
        
        for (uint32_t f = 0; f < NUM_FLAMES; f++)
        {
            if (!_flameActive[f])
                continue;
            
            // Move flame upward
            _flamePos[f] += distance;
            
            // Randomly change dimensions (5x per second average)
            if (random(1.0f) < dt * 5.0f)
            {
                _flameHeight[f] = 500.0f + random(700.0f);
                _flameWidth[f] = 200.0f + random(200.0f);
            }
            
            // Fade as it rises
            float heightAboveBase = _flamePos[f] - (Z_MIN + _baseHeightMm);
            if (heightAboveBase > 0)
            {
                float fadeFactor = 1.0f - (heightAboveBase / (TREE_HEIGHT * 2.5f));
                _flameIntensity[f] = fadeFactor > 0.5f ? fadeFactor : 0.5f;
            }
            
            // Deactivate if faded or reached top
            if (_flameIntensity[f] <= 0.0f || _flamePos[f] > Z_MAX)
            {
                _flameActive[f] = false;
                // Restart at bottom
                _flamePos[f] = Z_MIN + random(_baseHeightMm);
                _flameIntensity[f] = 0.85f + random(0.15f);
                _flameXOffset[f] = -600.0f + random(1200.0f);
                _flameYOffset[f] = -600.0f + random(1200.0f);
                _flameActive[f] = true;
            }
        }
    }
    
    void updateJets(float elapsed, float dt)
    {
        // Spawn new jets
        if (random(1.0f) < _jetSpawnRate * dt)
        {
            for (uint32_t j = 0; j < NUM_JETS; j++)
            {
                if (!_jetActive[j])
                {
                    _jetPos[j] = Z_MIN;
                    _jetActive[j] = true;
                    _jetMaxHeight[j] = TREE_HEIGHT * (0.3f + random(0.6f));
                    _jetWidth[j] = 80.0f + random(70.0f);
                    _jetXOffset[j] = -500.0f + random(1000.0f);
                    _jetYOffset[j] = -500.0f + random(1000.0f);
                    _jetBrightness[j] = 0.9f + random(0.1f);
                    break;
                }
            }
        }
        
        // Update jets
        float distance = dt * _jetSpeed;
        for (uint32_t j = 0; j < NUM_JETS; j++)
        {
            if (!_jetActive[j])
                continue;
            
            _jetPos[j] += distance;
            
            float heightTraveled = _jetPos[j] - Z_MIN;
            if (heightTraveled >= _jetMaxHeight[j])
            {
                _jetActive[j] = false;
            }
        }
    }
    
    void renderToPixels(float elapsed)
    {
        // Clear buffer
        for (uint32_t i = 0; i < NUM_LEDS; i++)
        {
            _ledR[i] = 0;
            _ledG[i] = 0;
            _ledB[i] = 0;
        }
        
        // Part 1: Base fire with dynamic edge
        for (uint32_t i = 0; i < NUM_LEDS; i++)
        {
            // Dynamic upper edge using sine waves
            float wave1 = sinf(2.0f * M_PI * 0.5f * elapsed + LED_X[i] * 0.01f + LED_Y[i] * 0.01f);
            float wave2 = sinf(2.0f * M_PI * 0.8f * elapsed + LED_X[i] * 0.015f);
            float wave3 = sinf(2.0f * M_PI * 1.2f * elapsed + LED_Y[i] * 0.012f);
            float heightVar = (wave1 + wave2 * 0.7f + wave3 * 0.5f) / 2.2f * 400.0f;
            float dynBaseHeight = _baseHeightMm + heightVar;
            
            float heightAboveMin = LED_Z[i] - Z_MIN;
            if (heightAboveMin <= dynBaseHeight)
            {
                float flicker = 0.85f + 0.15f * sinf(2.0f * M_PI * LED_FLICKER_FREQ[i] * 10.0f * elapsed + LED_FLICKER_PHASE[i]);
                flicker = clamp(flicker, 0.8f, 1.0f);
                
                if (heightAboveMin < _baseHeightMm * 0.7f)
                {
                    // Core - full brightness
                    _ledR[i] = (uint8_t)(LED_BASE_COLOR_R[i] * flicker * _maxBrightnessPC / 100.0f);
                    _ledG[i] = (uint8_t)(LED_BASE_COLOR_G[i] * flicker * _maxBrightnessPC / 100.0f);
                    _ledB[i] = (uint8_t)(LED_BASE_COLOR_B[i] * flicker * _maxBrightnessPC / 100.0f);
                }
                else
                {
                    // Edge - fade out
                    float edgePos = (heightAboveMin - _baseHeightMm * 0.7f) / (dynBaseHeight - _baseHeightMm * 0.7f + 1.0f);
                    float edgeIntensity = 1.0f - edgePos * 0.5f;
                    flicker *= edgeIntensity;
                    flicker = clamp(flicker, 0.5f, 1.0f);
                    
                    _ledR[i] = (uint8_t)(LED_BASE_COLOR_R[i] * flicker * _maxBrightnessPC / 100.0f);
                    _ledG[i] = (uint8_t)(LED_BASE_COLOR_G[i] * flicker * _maxBrightnessPC / 100.0f);
                    _ledB[i] = (uint8_t)(LED_BASE_COLOR_B[i] * flicker * _maxBrightnessPC / 100.0f);
                }
            }
        }
        
        // Part 2: Flame tongues
        renderFlames(elapsed);
        
        // Part 3: Jets
        renderJets(elapsed);
        
        // Write to pixel buffer
        for (uint32_t i = 0; i < NUM_LEDS; i++)
        {
            _pixels.setRGB(i, _ledR[i], _ledG[i], _ledB[i]);
        }
    }
    
    void renderFlames(float elapsed)
    {
        for (uint32_t f = 0; f < NUM_FLAMES; f++)
        {
            if (!_flameActive[f])
                continue;
            
            float flameBaseZ = _flamePos[f];
            float flameTopZ = flameBaseZ + _flameHeight[f];
            
            for (uint32_t i = 0; i < NUM_LEDS; i++)
            {
                if (LED_Z[i] < flameBaseZ || LED_Z[i] > flameTopZ)
                    continue;
                
                float flamePosition = (LED_Z[i] - flameBaseZ) / _flameHeight[f];
                
                // Expand outward as flames rise
                float expandFactor;
                if (flamePosition < 0.7f)
                    expandFactor = 1.0f + flamePosition * 1.4f;
                else
                    expandFactor = 2.4f - (flamePosition - 0.7f) * 1.0f;
                
                float flameWidthAtHeight = _flameWidth[f] * expandFactor;
                
                // Drift outward
                float driftFactor = flamePosition * flamePosition;
                float driftDirX = _flameXOffset[f] / (fabsf(_flameXOffset[f]) + 1.0f);
                float driftDirY = _flameYOffset[f] / (fabsf(_flameYOffset[f]) + 1.0f);
                float driftAmount = 300.0f * driftFactor;
                float flameCenterX = _flameXOffset[f] + driftDirX * driftAmount;
                float flameCenterY = _flameYOffset[f] + driftDirY * driftAmount;
                
                float dx = LED_X[i] - flameCenterX;
                float dy = LED_Y[i] - flameCenterY;
                float dist = sqrtf(dx*dx + dy*dy);
                
                if (dist > flameWidthAtHeight)
                    continue;
                
                float horizFade = 1.0f - (dist / flameWidthAtHeight);
                float intensity = _flameIntensity[f] * horizFade * (1.0f - flamePosition * 0.05f);
                
                float flicker = 0.85f + 0.15f * sinf(2.0f * M_PI * LED_FLICKER_FREQ[i] * 10.0f * elapsed + LED_FLICKER_PHASE[i]);
                
                // Color by height
                uint8_t r, g, b;
                if (flamePosition < 0.3f)
                {
                    r = 255; g = 217; b = 0;  // Bright yellow
                }
                else if (flamePosition < 0.6f)
                {
                    r = 255; g = 166; b = 0;  // Bright orange
                }
                else
                {
                    r = 255; g = 115; b = 0;  // Bright red
                }
                
                float finalIntensity = intensity * flicker * _maxBrightnessPC / 100.0f;
                _ledR[i] = maxU8(_ledR[i], (uint8_t)(r * finalIntensity));
                _ledG[i] = maxU8(_ledG[i], (uint8_t)(g * finalIntensity));
                _ledB[i] = maxU8(_ledB[i], (uint8_t)(b * finalIntensity));
            }
        }
    }
    
    void renderJets(float elapsed)
    {
        for (uint32_t j = 0; j < NUM_JETS; j++)
        {
            if (!_jetActive[j])
                continue;
            
            float jetBaseZ = Z_MIN;
            float jetTopZ = _jetPos[j];
            float jetLength = jetTopZ - jetBaseZ;
            
            if (jetLength < 1.0f)
                continue;
            
            for (uint32_t i = 0; i < NUM_LEDS; i++)
            {
                if (LED_Z[i] < jetBaseZ || LED_Z[i] > jetTopZ)
                    continue;
                
                float jetPosition = (LED_Z[i] - jetBaseZ) / jetLength;
                
                float taperFactor = 1.0f - jetPosition * 0.3f;
                float jetWidthAtHeight = _jetWidth[j] * taperFactor;
                
                float dx = LED_X[i] - _jetXOffset[j];
                float dy = LED_Y[i] - _jetYOffset[j];
                float dist = sqrtf(dx*dx + dy*dy);
                
                if (dist > jetWidthAtHeight)
                    continue;
                
                float horizFade = 0.9f + 0.1f * (1.0f - (dist / jetWidthAtHeight));
                float intensity = _jetBrightness[j] * horizFade;
                
                float flicker = 0.95f + 0.05f * sinf(2.0f * M_PI * LED_FLICKER_FREQ[i] * 10.0f * elapsed + LED_FLICKER_PHASE[i]);
                
                // Color by position
                const uint8_t* color;
                if (jetPosition > 0.7f)
                    color = JET_COLORS[0];  // Yellow tip
                else if (jetPosition > 0.4f)
                    color = JET_COLORS[1];  // Orange-yellow
                else
                    color = JET_COLORS[2];  // Orange base
                
                float finalIntensity = intensity * flicker * _maxBrightnessPC / 100.0f;
                _ledR[i] = maxU8(_ledR[i], (uint8_t)(color[0] * finalIntensity));
                _ledG[i] = maxU8(_ledG[i], (uint8_t)(color[1] * finalIntensity));
                _ledB[i] = maxU8(_ledB[i], (uint8_t)(color[2] * finalIntensity));
            }
        }
    }
    
    static constexpr const char* MODULE_PREFIX = "LEDPatFire";
};
